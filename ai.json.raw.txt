{
  "changes": [
    {
      "path": "main.js",
      "action": "upsert",
      "content": "// client side logic for the cooperative clicker\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  const counterEl = document.getElementById('counter');\n  const buttonEl = document.getElementById('click-btn');\n  let clickCount = 0;\n\n  /**\n   * Fetch the current count from the serverless function.\n   */\n  async function fetchCount() {\n    try {\n      const response = await fetch('/api/counter');\n      if (!response.ok) {\n        throw new Error('Failed to fetch count');\n      }\n      const data = await response.json();\n      counterEl.textContent = data.count;\n    } catch (err) {\n      console.error(err);\n    }\n  }\n\n  /**\n   * Increment the counter by making a POST request.\n   */\n  async function incrementCount() {\n    try {\n      const response = await fetch('/api/counter', {\n        method: 'POST'\n      });\n      if (!response.ok) {\n        throw new Error('Failed to increment count');\n      }\n      const data = await response.json();\n      counterEl.textContent = data.count;\n    } catch (err) {\n      console.error(err);\n    }\n  }\n\n  function createConfetti() {\n    const colors = ['#FF0D72', '#0ABAB5', '#F9D423', '#FF4E50'];\n    const confetti = document.createElement('div');\n    confetti.classList.add('confetti');\n    confetti.style.position = 'absolute';\n    confetti.style.width = '10px';\n    confetti.style.height = '10px';\n    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];\n    confetti.style.left = Math.random() * window.innerWidth + 'px';\n    confetti.style.top = Math.random() * window.innerHeight + 'px';\n    document.body.appendChild(confetti);\n    setTimeout(() => {\n      confetti.remove();\n    }, 3000);\n  }\n\n  // Hook up button click to increment\n  buttonEl.addEventListener('click', () => {\n    incrementCount();\n    clickCount++;\n    if (clickCount >= 100) {\n      createConfetti();\n      clickCount = 0;\n    }\n  });\n\n  // Poll the server every second to update the count in case others have clicked\n  setInterval(fetchCount, 1000);\n\n  // Immediately fetch the count when the page loads\n  fetchCount();\n});\n\n// AI form handling logic\n(function(){\n  const form = document.getElementById('aiForm');\n  if (!form) return;\n  const input = document.getElementById('aiPrompt');\n  const status = document.getElementById('aiStatus');\n  window.__AI_SECRET = \"LEONISCOOL\"; // Set the AI secret\n  form.addEventListener('submit', async (e) => {\n    e.preventDefault();\n    const prompt = (input.value || '').trim();\n    if (!prompt) return;\n    status.textContent = 'Sending to AIâ€¦';\n    try {\n      const r = await fetch('/api/dispatch-change', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'x-ai-secret': window.__AI_SECRET\n        },\n        body: JSON.stringify({ prompt, user: 'friend' })\n      });\n      if (!r.ok) throw new Error(await r.text());\n      status.textContent = 'Got it! A pull request will appear shortly.';\n      input.value = '';\n    } catch (err) {\n      status.textContent = 'Error sending prompt: ' + (err.message || err);\n    }\n  });\n})();\n"
    },
    {
      "path": "style.css",
      "action": "upsert",
      "content": ".confetti {\n  position: absolute;\n  width: 10px;\n  height: 10px;\n  opacity: 0.8;\n  animation: fall 3s ease-in;\n}\n\n@keyframes fall {\n  0% { transform: translateY(0); }\n  100% { transform: translateY(100vh); }\n}\n"
    }
  ]
}